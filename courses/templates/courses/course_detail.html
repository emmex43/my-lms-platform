{% extends 'courses/base.html' %}

{% block content %}
<div class="course-header">
    <h1>{{ course.title }}</h1>
    <p>{{ course.description|linebreaks }}</p>

    {% if user == course.instructor or user.is_superuser %}
    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px 0; border: 1px solid #ffeeba;">
        <strong style="color: #856404;">ğŸ‘¨â€ğŸ« Instructor Tools (Admin Access):</strong>
        <div style="margin-top: 10px;">
            <a href="{% url 'edit_course' course.id %}" class="btn"
                style="background: #f39c12; padding: 5px 15px; font-size: 0.9rem;">âœï¸ Edit</a>
            <a href="{% url 'delete_course' course.id %}" class="btn"
                style="background: #c0392b; padding: 5px 15px; font-size: 0.9rem;">ğŸ—‘ï¸ Delete</a>
            <a href="{% url 'add_lesson' course.id %}" class="btn"
                style="background: #27ae60; padding: 5px 15px; font-size: 0.9rem; margin-left: 10px;">â• Add Lesson</a>
        </div>
    </div>
    {% endif %}

    <div style="margin-top: 20px; margin-bottom: 20px;">
        {% if user.is_authenticated %}
        {% if user in course.students.all %}
        <button class="btn" style="background-color: #27ae60; cursor: default;">âœ… You are Enrolled</button>
        {% else %}
        <a href="{% url 'enroll_course' course.id %}" class="btn">Join This Class</a>
        {% endif %}
        {% else %}
        <a href="{% url 'account_login' %}" class="btn" style="background-color: #7f8c8d;">Login to Enroll</a>
        {% endif %}
    </div>
</div>

{% for session in course.live_sessions.all %}
{% if session.is_active %}
<div
    style="background-color: #ffebee; border: 2px solid #ef5350; border-radius: 10px; padding: 20px; margin-bottom: 30px; text-align: center; animation: pulse 2s infinite;">

    <h3 style="color: #c62828; margin: 0 0 10px 0;">ğŸ”´ LIVE NOW: {{ session.title }}</h3>
    <p style="color: #555;">The instructor is currently teaching live.</p>

    <a href="{{ session.get_join_url }}" target="_blank" class="btn"
        style="background-color: #d32f2f; color: white; padding: 12px 25px; font-weight: bold; font-size: 1.1rem; text-decoration: none; border-radius: 5px; display: inline-block; margin-top: 10px;">
        ğŸ“¹ JOIN LIVE CLASS
    </a>

</div>
{% endif %}
{% endfor %}

<style>
    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(239, 83, 80, 0.4);
        }

        70% {
            box-shadow: 0 0 0 10px rgba(239, 83, 80, 0);
        }

        100% {
            box-shadow: 0 0 0 0 rgba(239, 83, 80, 0);
        }
    }
</style>

<hr>

<h3>Syllabus</h3>
<ul class="lesson-list">
    {% for lesson in course.lessons.all %}
    <li class="lesson-item">
        <a href="{% url 'lesson_detail' course.id lesson.id %}"
            style="text-decoration: none; color: #333; display: block;">
            <strong>Lesson {{ forloop.counter }}:</strong>
            {{ lesson.title }}

            {% if user.is_authenticated %}
            <span style="float:right; color: #3498db;">Start â–¶</span>
            {% else %}
            <span style="float:right; color: #666;">ğŸ”’ Login to View</span>
            {% endif %}
        </a>
    </li>
    {% empty %}
    <li>No lessons added yet.</li>
    {% endfor %}
</ul>

<br>
<a href="{% url 'course_list' %}">â† Back to All Courses</a>
{% endblock %}